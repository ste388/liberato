body, html {
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: sans-serif;
  background-color: #333;
  color: white;
}

/* --- VISTE --- */
#editor-view, #castle-view, #game-view {
  display: none;
  width: 100vw;
  height: 100vh;
  box-sizing: border-box;
}

body[data-view="editor"] #editor-view { display: flex; }
body[data-view="castle"] #castle-view { display: flex; }
body[data-view="game"] #game-view { display: block; }

/* --- EDITOR UI --- */
#editor-view { flex-direction: column; }

#editor-ui {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(0,0,0,0.9);
  padding: 10px;
  z-index: 200;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid #555;
}

#palette-container {
  position: fixed;
  top: 0;
  right: 0;
  width: 240px;
  height: 100vh;
  background: rgba(0,0,0,0.9);
  z-index: 190;
  overflow-y: auto;
  padding: 70px 10px 10px;
  box-sizing: border-box;
  border-left: 1px solid #555;
}

#world-container {
  flex-grow: 1;
  overflow: auto;
  padding-top: 60px;
  background-color: #111;
}

#world {
  position: relative;
  background-color: #000;
  margin: 20px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.tool-btn {
  padding: 8px 15px;
  background: #444;
  color: white;
  border: 1px solid #666;
  cursor: pointer;
  border-radius: 4px;
}
.tool-btn:hover { background: #666; }
.tool-btn.active { background: #00798c; border-color: #00bcd4; }

.palette-section h3 {
  margin: 15px 0 10px;
  font-size: 1em;
  color: #aaa;
  border-bottom: 1px solid #444;
  padding-bottom: 5px;
}

.palette-item {
  width: 60px;
  height: 60px;
  margin: 5px;
  display: inline-block;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  cursor: grab;
  border: 1px solid #444;
  background-color: rgba(255,255,255,0.05);
  border-radius: 4px;
}
.palette-item:hover { border-color: white; background-color: rgba(255,255,255,0.1); }

/* --- MAPPA & GRAFICA --- */
.cell { position: absolute; box-sizing: border-box; }
.cell.void { background-color: #000; }

.cell.wall { background-image: url('https://ste388.github.io/liberato/pavimento/muro3.png'); background-size: cover; }
.cell.floor-1 { background-image: url('https://ste388.github.io/liberato/pavimento/p1.png'); background-size: cover; }
.cell.floor-2 { background-image: url('https://ste388.github.io/liberato/pavimento/p2.png'); background-size: cover; }
.cell.floor-3 { background-image: url('https://ste388.github.io/liberato/pavimento/p3.png'); background-size: cover; }
.cell.floor-4 { background-image: url('https://ste388.github.io/liberato/pavimento/p4.png'); background-size: cover; }
.cell.floor-5 { background-image: url('https://ste388.github.io/liberato/pavimento/p5.png'); background-size: cover; }

.placed-item {
  position: absolute;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  pointer-events: auto;
  z-index: 10;
}

/* --- OGGETTI --- */

/* Porte */
.type-porta1 { background-image: url('https://ste388.github.io/liberato/oggetti/porta1.png'); }
.type-porta1_aperta { background-image: url('https://ste388.github.io/liberato/oggetti/porta1_aperta.png'); }

.type-porta2 { background-image: url('https://ste388.github.io/liberato/oggetti/porta2.png'); }
.type-porta2_aperta { background-image: url('https://ste388.github.io/liberato/oggetti/porta2_aperta.png'); }

.type-porta3 { background-image: url('https://ste388.github.io/liberato/oggetti/porta3.png'); }
.type-porta3_aperta { background-image: url('https://ste388.github.io/liberato/oggetti/porta3_aperta.png'); }

.type-portaGemma { background-image: url('https://ste388.github.io/liberato/oggetti/portaGemma.png'); }
.type-portaGemma_aperta { background-image: url('https://ste388.github.io/liberato/oggetti/portaGemma_aperta.png'); }

/* Bauli */
.type-baule1 { background-image: url('https://ste388.github.io/liberato/oggetti/baule1.png'); }
.type-baule1_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule1_Aperto.png'); }

.type-baule2 { background-image: url('https://ste388.github.io/liberato/oggetti/baule2.png'); }
.type-baule2_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule2_Aperto.png'); }

.type-baule3 { background-image: url('https://ste388.github.io/liberato/oggetti/baule3.png'); }
.type-baule3_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule3_Aperto.png'); }

.type-baule4 { background-image: url('https://ste388.github.io/liberato/oggetti/baule4.png'); }
.type-baule4_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule4_Aperto.png'); }

.type-baule5 { background-image: url('https://ste388.github.io/liberato/oggetti/baule5.png'); }
.type-baule5_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule5_Aperto.png'); }

.type-baule6 { background-image: url('https://ste388.github.io/liberato/oggetti/baule6.png'); }
.type-baule6_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule6_Aperto.png'); }

.type-baule7 { background-image: url('https://ste388.github.io/liberato/oggetti/baule7.png'); }
.type-baule7_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule7_Aperto.png'); }

.type-baule8 { background-image: url('https://ste388.github.io/liberato/oggetti/baule8.png'); }
.type-baule8_Aperto { background-image: url('https://ste388.github.io/liberato/oggetti/baule8_Aperto.png'); }

/* Altri Oggetti */
.type-fontana { background-image: url('https://ste388.github.io/liberato/oggetti/fontana.png'); }

/* Decori Nuovi e Vecchi */
.type-decoro1 { background-image: url('https://ste388.github.io/liberato/oggetti/decoration1.png'); }
.type-colonna1 { background-image: url('https://ste388.github.io/liberato/oggetti/colonna1.png'); }
.type-colonna2 { background-image: url('https://ste388.github.io/liberato/oggetti/colonna2.png'); }
.type-obelisco { background-image: url('https://ste388.github.io/liberato/oggetti/obelisco.png'); }
.type-oro { background-image: url('https://ste388.github.io/liberato/oggetti/oro.png'); }
.type-sabbia1 { background-image: url('https://ste388.github.io/liberato/oggetti/sabbia1.png'); }

/* Cespugli */
.type-cespuglio1 { background-image: url('https://ste388.github.io/liberato/pavimento/cespuglio1.png'); z-index: 56; }
.type-cespuglio2 { background-image: url('https://ste388.github.io/liberato/pavimento/cespuglio2.png'); z-index: 56; }
.type-cespuglio3 { background-image: url('https://ste388.github.io/liberato/pavimento/cespuglio3.png'); z-index: 56; }
.type-cespuglio4 { background-image: url('https://ste388.github.io/liberato/pavimento/cespuglio4.png'); z-index: 56; }
.type-cespuglio5 { background-image: url('https://ste388.github.io/liberato/pavimento/cespuglio5.png'); z-index: 56; }

/* Nemici */
.type-orchetto1 { background-image: url('https://ste388.github.io/liberato/Nemici/orchetto1.png'); z-index: 58; }
.type-gnomo1 { background-image: url('https://ste388.github.io/liberato/Nemici/gnomo1.png'); z-index: 58; }
.type-miliziano1 { background-image: url('https://ste388.github.io/liberato/Nemici/miliziano1.png'); z-index: 58; }
.type-troll1 { background-image: url('https://ste388.github.io/liberato/Nemici/troll1.png'); z-index: 58; }
.type-stregone1 { background-image: url('https://ste388.github.io/liberato/Nemici/stregone1.png'); z-index: 58; }
.type-goblin1 { background-image: url('https://ste388.github.io/liberato/Nemici/goblin1.png'); z-index: 58; }
.type-guerr_goblin1 { background-image: url('https://ste388.github.io/liberato/Nemici/Guerr_goblin1.png'); z-index: 58; }
.type-morte { background-image: url('https://ste388.github.io/liberato/Nemici/morte1.png'); z-index: 58; }

/* MORTE */
.type-dead { 
  background-image: url('https://ste388.github.io/liberato/Sfondo/morte.png') !important; 
  z-index: 50 !important;
}

/* --- UI Gioco --- */
#game-view { position: relative; overflow: hidden; background-color: #000; }
#game-world { position: absolute; transition: transform 0.2s ease-out; }

#minimap {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 200px;
  height: 266px;
  background: black;
  border: 2px solid #666;
  z-index: 150;
  border-radius: 5px;
}
#minimap-canvas { width: 100%; height: 100%; }

#game-ui {
  position: fixed;
  top: 306px;
  left: 20px;
  width: 200px;
  background: rgba(0,0,0,0.9);
  padding: 15px;
  border-radius: 8px;
  z-index: 150;
  border: 2px solid #666;
  color: #fff;
  box-sizing: border-box;
}

#game-ui h3 {
  margin: 0 0 10px 0;
  font-size: 1.1em;
  color: #eca;
  text-align: center;
}

#hero-selector {
  width: 100%;
  margin-bottom: 10px;
  padding: 5px;
  background: #333;
  color: white;
  border: 1px solid #666;
  border-radius: 3px;
}

#game-ui > div {
  margin: 5px 0;
  font-size: 0.9em;
}

.stat-icon { width: 18px; height: 18px; vertical-align: middle; margin-left: 5px; }

#inventory-btn {
  width: 100%;
  margin-top: 15px;
  padding: 10px;
  background: rgba(0,0,0,0.8);
  color: white;
  border: 2px solid gold;
  border-radius: 5px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 1em;
  font-weight: bold;
}
#inventory-btn:hover { background: rgba(50,50,0,0.8); border-color: #ffcc00; }
#inventory-btn img { width: 24px; height: 24px; }

#return-to-editor-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 150;
  padding: 10px 20px;
  background: rgba(0,0,0,0.8);
  color: white;
  border: 2px solid #c00;
  border-radius: 5px;
  cursor: pointer;
}
#return-to-editor-btn:hover { background: rgba(100,0,0,0.8); }

#players-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }
.player-character { position: absolute; pointer-events: auto; cursor: pointer; transition: left 0.2s, top 0.2s; background-size: contain; background-repeat: no-repeat; background-position: center; }
.player-character.active { filter: drop-shadow(0 0 5px gold); }

#fog-canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 100; }

.enemy-tooltip {
  position: fixed;
  background: rgba(0,0,0,0.95);
  color: white;
  padding: 10px;
  border: 2px solid #ff4400;
  border-radius: 5px;
  z-index: 1000;
  pointer-events: none;
  font-size: 14px;
}

#combat-message {
  position: fixed;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.9);
  color: #ff3333;
  padding: 20px 40px;
  border: 3px solid #ff3333;
  border-radius: 10px;
  font-size: 2em;
  font-weight: bold;
  z-index: 2000;
  display: none;
  text-align: center;
}

#castle-view {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: url('https://ste388.github.io/liberato/Sfondo/castello.jpg') center/cover;
}

#hero-selection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 15px;
  margin: 20px 0;
  max-height: 50vh;
  overflow-y: auto;
}
.hero-card {
  background: rgba(30,30,30,0.9);
  padding: 10px;
  border: 2px solid #555;
  border-radius: 5px;
  cursor: pointer;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.hero-card:hover { border-color: #0a0; background: rgba(50,50,50,0.9); }
.hero-card img {
  width: 64px;
  height: 64px;
  object-fit: contain;
  margin-bottom: 5px;
}
.hero-name { font-weight: bold; color: #eca; margin-bottom: 3px; }
.hero-stats { font-size: 0.8em; color: #ccc; }

.hired-hero {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: rgba(0,200,0,0.2);
  border: 2px solid #0a0;
  border-radius: 5px;
  margin: 5px 0;
}
.hired-hero img {
  width: 50px;
  height: 50px;
  object-fit: contain;
}
.hired-hero input {
  padding: 5px;
  background: #333;
  border: 1px solid #666;
  color: white;
}
.remove-btn:hover { background: #f00 !important; }

/* Modali Generiche */
.modal { display: none; position: fixed; z-index: 500; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
.modal-content { background: #222; padding: 20px; border: 2px solid #666; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
.close-btn { float: right; cursor: pointer; font-size: 24px; }

/* Inventario */
#inventory-grid { margin-top: 15px; max-height: 400px; overflow-y: auto; }
.inventory-equipment { background: rgba(50,50,150,0.2); padding: 10px; border-radius: 5px; margin-bottom: 10px; }
.inventory-item-row { padding: 5px; border-bottom: 1px solid #444; }
